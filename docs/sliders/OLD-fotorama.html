<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Fotorama - Barney integration demo</title>
	<link rel="stylesheet" href="../css/main.css">

	<!-- jQuery 1.8 or later, 33 KB -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<!-- Fotorama from CDNJS, 19 KB -->
	<link  href="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.js"></script>

</head>
<body>

	<div id="wrap">
		
		<h1>Fotorama</h1>

		<div class="fakeText -small"></div>

		<div class="fotorama" data-width="100%" data-ratio="16/9" data-arrows="true" data-click="false" data-allowfullscreen="true" data-swipe="true" data-loop="true">
			<div><div class="fakeImage"></div></div>
			<div><div class="fakeImage"></div></div>
			<div>
				<script async src="http://localhost:8080/api.js"></script>
				<barney-viewer url="http://localhost:8080/?b3d=/items/fox/item.b3d" touch="cooperative" maxres="1k" ratio="16:9" pointer-proxy></barney-viewer>
			</div>
			<div>
				<script async src="http://localhost:8080/api.js"></script>
				<barney-viewer url="http://localhost:8080/?b3d=/items/fox/item.b3d" touch="cooperative" maxres="1k" ratio="16:9" pointer-proxy></barney-viewer>
			</div>
		</div>

		<div class="fakeText -small"></div>

		<div class="fakeText -large"></div>

	</div>

	<script>
		jQuery(document).ready(function($) {
			const $fotorama = $('.fotorama')
			const fotorama = $fotorama.data('fotorama')
			

			// resume current viewer
			$fotorama.on('fotorama:ready', (event, fotorama, extra) => {
				console.log('>>>')
			})

			// resume current viewer
			$fotorama.on('fotorama:show', (event, fotorama, extra) => {
				// const active = Barney.initViewer(fotorama.activeFrame.html)
				// active.forEach(viewer => viewer.setBackground({ color: '#00f' }))
			})
			
			// pauses inactive viewers
			$fotorama.on('fotorama:showend', (event, fotorama, extra) => {
				const active = Barney.initViewer(fotorama.activeFrame.html)
				active.forEach(viewer => {
					viewer.setBackground && viewer.setBackground({ color: '#00f' })
				})
				const all = Barney.initViewer($fotorama.get(0))
				all.forEach(viewer => {
					if (active.includes(viewer)) return
					viewer.setBackground && viewer.setBackground({ color: '#f00' })
				})
			})
		});
	</script>

</body>
</html>