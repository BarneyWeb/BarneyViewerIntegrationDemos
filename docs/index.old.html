<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Barney integration demo</title>

	<!-- Bootstrap -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
	<!-- End Bootstrap -->

	<!-- <link rel="stylesheet" href="../css/main.css"> -->

</head>
<body>

	<div id="wrap">
		
		<h1>Basic</h1>

		<div class="fakeText -small"></div>

		<script async src="http://192.168.1.71:8080/api.js"></script>
		<barney-viewer id="my-viewer" url="http://192.168.1.71:8080/?b3d=/items/fox/item.b3d" mouse="cooperative" maxres="1k" ratio="16:9"></barney-viewer>
		<script>
			(function(B,a,r,n,e,y){n=B[a]||(B[a]={}),e=n[r]||(n[r]=
			function(d){n[r].done?d():(y=e.callbacks||(e.callbacks=
			[]),y.push(d));});}(window,'Barney','ready'));

			Barney.ready(() => {
				const viewer = Barney.initViewer('#my-viewer')[0]
				console.log(viewer)
			})
		</script>

		<div class="fakeText -large"></div>

	</div>

	<script>
		jQuery(document).ready(function($) {
			const $fotorama = $('.fotorama')
			const fotorama = $fotorama.data('fotorama')
			

			// resume current viewer
			$fotorama.on('fotorama:ready', (event, fotorama, extra) => {
				console.log('>>>')
			})

			// resume current viewer
			$fotorama.on('fotorama:show', (event, fotorama, extra) => {
				// const active = Barney.initViewer(fotorama.activeFrame.html)
				// active.forEach(viewer => viewer.setBackground({ color: '#00f' }))
			})
			
			// pauses inactive viewers
			$fotorama.on('fotorama:showend', (event, fotorama, extra) => {
				const active = Barney.initViewer(fotorama.activeFrame.html)
				active.forEach(viewer => {
					viewer.setBackground && viewer.setBackground({ color: '#00f' })
				})
				const all = Barney.initViewer($fotorama.get(0))
				all.forEach(viewer => {
					if (active.includes(viewer)) return
					viewer.setBackground && viewer.setBackground({ color: '#f00' })
				})
			})
		});
	</script>

</body>
</html>